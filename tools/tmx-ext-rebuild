#!/data/data/com.termux/files/usr/bin/bash
# rebuild_query_local.sh - build _query.so locally for Termux without touching system package

set -e

# Setup
pkg install clang python python libffi
pip install --upgrade cython setuptools wheel

# Find _query.pyx
PKG_DIR=$(python -c "import ani_yt, os; print(os.path.dirname(ani_yt.__file__))")
if [ ! -f "$PKG_DIR/_query.pyx" ]; then
    echo "_query.pyx not found"
    exit 1
fi

# Build
cythonize -i $PKG_DIR/_query.pyx

# Check
ls $PKG_DIR
